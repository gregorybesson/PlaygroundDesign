<?php $this->plugin('translate')->setTranslatorTextDomain('playgrounddesign');// Pour le texte ?>

<?php $achievements    = $this->activityWidget();?>
<?php $leaderboard     = $this->leaderboardWidget();?>
<?php $baseUrl         = $this->url('frontend', array('force_canonical' => true)); ?>

<div class="sidebar col-md-4">

    <!-- BLOCK NEWSLETTER -->
	<?php if($this->zfcUserIdentity() && ! $this->zfcUserIdentity()->getOptin()): ?>
	    <div class="sb-block newsletter-connect">
	    	<img src="<?php echo $this->frontendAssetPath('images/common/icon-newsletter.png')?>" alt="newsletter" />
	    	<h5 class="sb-block-title"><?php echo $this->translate('Sign up for the newsletter and never miss a game!'); ?></h5>
			<div class="sb-block-content">
			    <form action="<?php echo $this->url('frontend/zfcuser/ajax_newsletter');?>" method="POST" id="ajax-newsletter">
			        <input type="hidden" value="1" name="optin" />
			    	<input class="btn btn-default up" type="submit" value="<?php echo $this->translate('Sign up now!'); ?>"/>
			    </form>
			    <div class="suscribe-success"><?php echo $this->translate('Thank you, your registration is taken into account!'); ?></div>
			</div>
	    </div>
    <?php endif; ?>
    <!-- END BLOCK NEWSLETTER -->

    <?php if(($this->dynablockWidget('column_home')) != ''):?>
    	<?php foreach($this->dynablockWidget('column_home') as $block): ?>
    		<div class="sb-block ad"><?php echo $block ?></div>
    	<?php endforeach; ?>
    	<?php //echo $this->dynablockWidget('column_home') ;?>
    <?php endif; ?>

	<!-- BLOCK TONNES CADEAUX -->
	<?php if(!$this->zfcUserIdentity()): ?>
	    <div class="sb-block tonnes-cadeaux">
	    	<img src="<?php echo $this->frontendAssetPath('images/common/icon-gifts.png')?>" alt="gifts" />
            <h5><?php echo $this->translate('Win a lot of gits !'); ?></h5>
	    	<div class="sb-content">
		    	<div class="txt"><?php echo $this->translate('Sign up and join the Playground contests our partners to win loads of gifts.'); ?></div>
		    	<div class="accroche"><?php echo $this->translate('Playground is 100% free!'); ?></div>
		    	<a class="btn btn-default up" href="<?php echo $this->url('frontend/zfcuser/register') . ($this->redirect ? '?redirect='.$this->redirect : '') ?>"><?php echo $this->translate('Sign up now!'); ?></a>
		    	<a class="btn btn-inverse" href="<?php echo $this->url('frontend/zfcuser/register') . ($this->redirect ? '?redirect='.$this->redirect : '') ?>"><?php echo $this->translate('Connection'); ?></a>
		    </div>
	    </div>
    <?php endif; ?><!-- END BLOCK TONNES CADEAUX -->
    
    <?php if ($this->facebookUrl()): ?>
    <!-- BLOCK FACEBOOK -->
    <div class="sb-block fb-box">
    	<h5><?php echo $this->translate('Join us on Facebook'); ?></h5>
    	<div class="sb-content">
    	   <div class="fb-like-box" data-href="<?php echo $this->facebookUrl(); ?>" data-width="280" data-height="291" data-show-faces="true" data-stream="false" data-border-color="#eeefef" data-header="false"></div>
	    </div>
    </div><!-- END BLOCK FACEBOOK -->
    <?php endif; ?>

    <!-- BLOCK NEWSLETTER -->
    <!-- <?php if(!$this->zfcUserIdentity()): ?>
    	    <div class="sb-block newsletter">
    	    	<img src="<?php echo $this->frontendAssetPath('images/common/icon-newsletter.png')?>" width="82" height="81" border="0" alt="newsletter" />
    			<div class="bg-sdblock">
    				<p class="green"><?php echo $this->translate('Sign up for the newsletter and never miss a game!'); ?></p>
    		    	<form action="" method="POST">
    		    		<input class="input" type="email" name="email" value="<?php echo $this->translate('Your email address'); ?>" onclick="if(this.value=='<?php echo $this->translate('Your email address'); ?>'){this.value=''}" onblur="if(this.value==''){this.value='<?php echo $this->translate('Your email address'); ?>'} " />
    		    		<input class="btn btn-greendark" type="submit" value="Ok"/>
    		    	</form>
    		    </div>
    	    </div>
    <?php endif; ?> -->
    <!-- END BLOCK NEWSLETTER -->

    <!-- BLOCK WIN POINTS -->
    <?php if($this->zfcUserIdentity()): ?>
		<div class="sb-block win-points">
			<img src="<?php echo $this->frontendAssetPath('images/common/icon-cup-home.png')?>" alt="cup" />
            <h5><?php echo $this->translate('Earn more points!'); ?></h5>
			<div class="sb-content">
				<ul class="links-list">
					<li class="coordonnees">
						<a href="<?php echo $this->url('frontend/zfcuser/profile');?>" class="sb-picto-link">
						    <!-- <img src="<?php //echo $this->frontendAssetPath('images/common/btn-coordonnees-hd.png')?>" alt="coordonnees" /> -->
							<?php echo $this->translate('Fill in your details'); ?>
							50 points
						</a>
					</li>
					<li class="parrain">
						<a href="<?php echo $this->url('frontend/sponsorfriends'); ?>" class="sb-picto-link">
                             <!--<img src="<?php //echo $this->frontendAssetPath('images/common/btn-parrain-hd.png')?>" alt="parrain" /> -->
							<?php echo $this->translate('Refer your friends'); ?>
							100 points <?php echo $this->translate('by friend sponsored'); ?>
						</a>
					</li>
					<li class="partage">
						<a href="<?php echo $this->url('frontend/sponsorfriends'); ?>" class="sb-picto-link">
                           <!--  <img src="<?php //echo $this->frontendAssetPath('images/common/btn-partage-hd.png')?>" alt="partage" /> -->
							<?php echo $this->translate('Share on social networks'); ?>
							50 points
						</a>
					</li>
				</ul>
			</div>
		</div>
	<?php endif; ?><!-- END BLOCK WIN POINTS -->

    <!-- BLOCK HOW IT WORKS -->
    <div class="sb-block how-works">
    	<img src="<?php echo $this->frontendAssetPath('images/common/icon-question.png')?>" alt="question" />
    	<h5><?php echo $this->translate('How it works ?'); ?></h5>
		<div class="sb-content">
	    	<ul class="links-list">
	    		<li class="connect">
                   <!-- <img src="<?php //echo $this->frontendAssetPath('images/common/btn-connect-account-hd.png')?>" alt="connect" /> -->
	    		    <a href="<?php echo $this->url('frontend/zfcuser/register') . ($this->redirect ? '?redirect='.$this->redirect : '') ?>"><?php echo $this->translate('Register'); ?></a> <?php echo $this->translate('or'); ?><br />
	    		    <a href="<?php echo $this->url('frontend/zfcuser/register') . ($this->redirect ? '?redirect='.$this->redirect : '') ?>"><?php echo $this->translate('log in'); ?></a> <?php echo $this->translate('to your account'); ?>
    		    </li>
	    		<li class="game-play">
                    <!-- <img src="<?php // echo $this->frontendAssetPath('images/common/btn-contest-play-hd.png')?>" alt="gameplay" />-->
	    		    <a href="<?php echo $this->url('frontend/gameslist'); ?>"><?php echo $this->translate('Participate in contests'); ?></a>
	    		    <?php echo $this->translate('to win prizes'); ?>
    		    </li>
	    		<li class="gain-points">
                    <!--<img src="<?php //echo $this->frontendAssetPath('images/common/btn-earn-points-hd.png')?>" alt="gain" />-->
                    <?php echo $this->translate('Collect points and earn badges.'); ?>
                </li>
	    	</ul>
	    	<a href="<?php echo $this->url('frontend/cms', array('id' => 'comment-ca-marche')); ?>" class="link how-works"><?php echo $this->translate('See how to earn more points!'); ?></a>
	   </div>
    </div><!-- END BLOCK HOW IT WORKS -->

    <!-- BLOCK CLASSEMENT -->
    <div class="sb-block ranking">
        <img src="<?php echo $this->frontendAssetPath('images/common/icon-ranking.png')?>" alt="classement" />
    	<h5>
    	    <a href="<?php echo $this->url('frontend/reward/leaderboard', array('period'=>'general')); ?>"><?php echo $this->translate('Ranking'); ?></a>
    	</h5>
    	<div class="sb-content">
        	<div class="btn-group btn-group-justified">
        		<!--<a href="#" class="btn btn-default up week active"><?php // echo $this->translate('This week'); ?></a> -->
        		<a href="#" class="btn btn-default up general active"><?php echo $this->translate('General'); ?></a>
        	</div>
        	<ul class="list">
        	    <?php $i=1;foreach($leaderboard as $entry):?>
    				<li class="row general rank<?php echo $i?>">
    				    <div class="rank"><?php echo $i ?></div>
    					<div class="avatar">
    						<?php if($entry['avatar']): ?>
    							<img src="<?php echo $this->basePath($entry['avatar'])?>" alt="<?php echo $entry['firstname']; ?> <?php echo $entry['lastname']; ?>"  width="33" height="33" border="0" />
    						<?php elseif($entry['title'] && $entry['title'] == 'M') : ?>
    							<img src="<?php echo $this->frontendAssetPath('images/user/no-avatar-small-h.png'); ?>" alt="<?php echo $entry['firstname']; ?> <?php echo $entry['lastname']; ?>" width="33" height="33" border="0" />
    						<?php else : ?>
    							<img src="<?php echo $this->frontendAssetPath('images/user/no-avatar-small-f.png'); ?>" alt="<?php echo $entry['firstname']; ?> <?php echo $entry['lastname']; ?>" width="33" height="33" border="0" />
    						<?php endif; ?>
    					</div>
    	    			<div class="name">
    	    				<?php
    	    				if($entry['username']):
    	    					echo $entry['username'];
    						else :
    							echo $entry['firstname'].' '.substr($entry['lastname'], 0, 1).'.';
    						endif;
    	    				?>
    	    			</div>
    	    			<div class="points">(<?php echo number_format($entry['points'], 0, ',', ' ' ); ?> points)</div>
    				</li>
    			<?php $i++;endforeach;?>

        		<?php if($this->zfcUserIdentity()): ?>
        			<?php $rank =  $this->rankWidget($this->zfcUserIdentity()->getId());?>
    	    		<li class="row general current">
    					<!-- <div class="position"><?php //echo $this->translate('Your position'); ?></div> -->
						<div class="avatar">
							<?php if($this->zfcUserIdentity()->getAvatar()):?>
								<img src="<?php echo $this->basePath($this->zfcUserIdentity()->getAvatar()) ?>" width="33" height="33" border="0" alt="<?php echo $this->zfcUserIdentity()->getFirstname(); ?> <?php echo $this->zfcUserIdentity()->getLastname(); ?>" />
							<?php else:?>
								<?php if($this->zfcUserIdentity()->getTitle() && $this->zfcUserIdentity()->getTitle() == 'M'): ?>
	        			        	<img src="<?php echo $this->frontendAssetPath('images/user/no-avatar-small-h.png'); ?>" alt="<?php echo $this->zfcUserIdentity()->getFirstname(); ?> <?php echo $this->zfcUserIdentity()->getLastname(); ?>" width="33" height="33" border="0" />
	        			    	<?php else: ?>
	        			    		<img src="<?php echo $this->frontendAssetPath('images/user/no-avatar-small-f.png'); ?>" alt="<?php echo $this->zfcUserIdentity()->getFirstname(); ?> <?php echo $this->zfcUserIdentity()->getLastname(); ?>" width="33" height="33" border="0" />
	        			    	<?php endif; ?>
	        			    <?php endif;?>
						</div>
						<div class="points">
						    <?php echo number_format($rank['points'], 0, ',', ' ' );?> points<br />
							<?php echo $rank['rank']; ?>
							<sup>
							<?php
								if($rank['rank'] == 1){
									echo $this->translate('first_place');
								}elseif($rank['rank'] == 2){
									echo $this->translate('second_place');
								}elseif($rank['rank'] == 3){
									echo $this->translate('third_place');
								}else{
									echo $this->translate('other_place');
								}
							?>
							</sup> position
						</div>
    				</li>
    			<?php endif; ?>
        	</ul>
    	</div>
    </div>

    <!-- BLOC ACTIVITES RECENTES -->
    <?php if (count($achievements) > 0): ?>
    <div class="sb-block activities">
    	<img src="/frontend/images/common/icon-activities.png" alt="classement">
    	<h5>
    	    <a href="#"><?php echo $this->translate('Recent activity'); ?></a>
    	</h5>
    	<ul class="liste">
    	   <?php foreach($achievements as $achievement):?>
    		<li>
    			<img src="<?php
    						if($achievement->getUser() && $achievement->getUser()->getAvatar()) :
    							echo $this->basePath($achievement->getUser()->getAvatar());
    						elseif($achievement->getUser() && $achievement->getUser()->getTitle() && $achievement->getUser()->getTitle() == 'M') :
    							echo $this->frontendAssetPath('images/user/no-avatar-small-h.png');
    						else :
    							echo $this->frontendAssetPath('images/user/no-avatar-small-f.png');
    						endif;
    					?>" width="33" height="33" border="0" alt="avatar" />
    			<span class="name">
    			     <?php if($achievement->getUser()) : ?>
    			         <?php if ($achievement->getUser()->getUsername()) : ?>
    				    	   <?php echo $achievement->getUser()->getUsername(); ?>
    					 <?php else : ?>
    					       <?php echo $achievement->getUser()->getFirstname().' '.substr($achievement->getUser()->getLastname(), 0, 1).'.'; ?>
    					 <?php endif;?>
    				<?php endif;?>
    			</span> <?php echo $this->translate('received the badge'); ?> <?php echo $achievement->getLabel() . " " . ucfirst(strtolower($achievement->getLevelLabel()));?>
    		</li>
    		<?php endforeach;?>
    	</ul>
    </div>
	<?php endif; ?>
	<!-- END BLOC ACTIVITES RECENTES -->

	<?php
		try {
		    $channel = \Laminas\Feed\Reader\Reader::import($this->rssUrl);
		} catch (Exception $e){
		    $channel = array();
		}

	?>
	<?php if(count($channel) > 0):?>
	<!-- BLOC NEWS -->
	<div class="sb-block news-feed">
		<h5>Sur TF1</h5>
        <div class="sb-content">
    		<?php $i=1; foreach ($channel as $item) : ?>
        		<?php if($i>5):?>
        		    <?php break;?>
        		<?php endif;?>
        		<?php if($i==1):?>
        		<div class="news-one row">
        			<p class="head-news">A la une</p>
        			<a href="<?php echo $item->getLink(); ?>" target="_blank">
        				<img src="<?php echo $item->getEnclosure()->url; ?>" alt="actualit� � la une : <?php echo $item->getTitle(); ?>" />
        				<div class="title-news"><?php echo $item->getTitle(); ?></div>
        				<div class="content-news"><?php echo $item->getDescription(); ?></div>
        			</a>
        		</div>
        		<?php endif;?>
        		<?php if($i==2) :?>
        		<div class="news-list row">
        			<p class="head-news">Dans l�actu</p>
        			<ul>
        		<?php endif;?>
        		<?php if($i>=2):?>
        				<li <?php if($i&1) : echo 'class="right"'; endif; ?>>
        					<a href="<?php echo $item->getLink(); ?>" target="_blank">
        						<img src="<?php echo $item->getEnclosure()->url; ?>" height="63" border="0" alt="actualit� : <?php echo $item->getTitle(); ?>" />
        						<div class="content-news"><?php echo $item->getTitle(); ?></div>
        					</a>
        				</li>
        		<?php endif;?>
        		<?php if($i==5):?>
        			</ul>
        		</div>
        		<?php endif;?>
    		<?php $i++; endforeach; ?>
		</div>
	</div><!-- END BLOC NEWS -->
	<?php endif;?>

</div>